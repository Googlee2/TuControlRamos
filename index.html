<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TuControl</title>

<style>
body{
    font-family:Arial, sans-serif;
    background:#f2f2f2;
    padding:20px;
}
.card{
    max-width:420px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:10px;
    box-shadow:0 5px 15px rgba(0,0,0,.2);
}
input,button{
    width:100%;
    padding:10px;
    margin-top:10px;
}
button{
    background:#0a7;
    color:#fff;
    border:none;
    border-radius:5px;
    font-size:16px;
}
img{
    max-width:100%;
    margin-top:10px;
    border-radius:6px;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card" id="login">
    <h2>Ingreso empresa</h2>
    <input id="empresa" placeholder="Empresa">
    <input id="clave" type="password" placeholder="Clave">
    <button onclick="ingresar()">Ingresar</button>
</div>

<div class="card hidden" id="panel">
    <h2 id="empresaTitulo"></h2>

    <input type="file" id="fileInput" accept="image/*">
    <button onclick="subir()">Subir imagen</button>

    <div id="imagenes"></div>
</div>

<script>
function esCelular(){
    return /Android|iPhone|iPad/i.test(navigator.userAgent);
}

function ingresar(){
    if(!empresa.value || !clave.value){
        alert("Completa los datos");
        return;
    }
    localStorage.setItem("empresa", empresa.value);
    login.classList.add("hidden");
    panel.classList.remove("hidden");
    empresaTitulo.textContent = "Empresa: " + empresa.value;
    cargarImagenes();
}

function subir(){
    const file = fileInput.files[0];
    if(!file) return;

    if(esCelular()){
        comprimirImagen(file);
    }else{
        leerImagen(file);
    }
}

function comprimirImagen(file){
    const reader = new FileReader();
    reader.onload = e=>{
        const img = new Image();
        img.onload = ()=>{
            const canvas = document.createElement("canvas");
            const max = 1280;
            let w = img.width;
            let h = img.height;

            if(w > h && w > max){
                h *= max / w;
                w = max;
            }else if(h > max){
                w *= max / h;
                h = max;
            }

            canvas.width = w;
            canvas.height = h;
            canvas.getContext("2d").drawImage(img,0,0,w,h);

            const data = canvas.toDataURL("image/jpeg",0.7);
            guardarImagen(data);
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function leerImagen(file){
    const reader = new FileReader();
    reader.onload = e => guardarImagen(e.target.result);
    reader.readAsDataURL(file);
}

function guardarImagen(data){
    const emp = localStorage.getItem("empresa");
    const imgs = JSON.parse(localStorage.getItem(emp) || "[]");
    imgs.push(data);
    localStorage.setItem(emp, JSON.stringify(imgs));
    cargarImagenes();
}

function cargarImagenes(){
    const emp = localStorage.getItem("empresa");
    const imgs = JSON.parse(localStorage.getItem(emp) || "[]");
    imagenes.innerHTML = "";
    imgs.forEach(src=>{
        const img = document.createElement("img");
        img.src = src;
        imagenes.appendChild(img);
    });
}

window.onload = ()=>{
    const emp = localStorage.getItem("empresa");
    if(emp){
        login.classList.add("hidden");
        panel.classList.remove("hidden");
        empresaTitulo.textContent = "Empresa: " + emp;
        cargarImagenes();
    }
};
</script>

</body>
</html>
