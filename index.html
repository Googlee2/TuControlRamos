<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TuControlRamos - Sistema Premium</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none !important; }

        /* LOGIN STYLES */
        .login-wrapper {
            max-width: 450px;
            margin: 0 auto;
        }

        .login-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
        }

        .login-header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .login-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .login-body {
            padding: 35px 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            width: auto;
            padding: 10px 20px;
            font-size: 13px;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .error-msg {
            color: var(--danger);
            font-size: 13px;
            margin-top: 10px;
            text-align: center;
            font-weight: 500;
        }

        /* PANEL HEADER */
        .panel-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 25px 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .panel-header-left h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-empresa {
            background: rgba(255, 255, 255, 0.25);
            color: white;
        }

        .badge-admin {
            background: rgba(255, 255, 255, 0.25);
            color: white;
        }

        /* PANEL BODY */
        .panel-body {
            padding: 30px;
        }

        .upload-section {
            background: var(--light);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 2px dashed var(--border);
        }

        .upload-section h3 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .status-msg {
            text-align: center;
            margin-top: 12px;
            font-size: 13px;
            font-weight: 600;
            min-height: 20px;
        }

        .status-success { color: var(--success); }
        .status-error { color: var(--danger); }
        .status-info { color: var(--primary); }

        /* GRID DE IM√ÅGENES */
        .section-title {
            color: var(--dark);
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }

        .image-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .image-wrapper {
            width: 100%;
            height: 180px;
            overflow: hidden;
            background: var(--light);
            position: relative;
        }

        .image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .image-wrapper:hover img {
            transform: scale(1.1);
        }

        .image-info {
            padding: 12px;
        }

        .image-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .image-meta {
            font-size: 11px;
            color: #6b7280;
        }

        .btn-delete {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        /* VISOR DE IMAGEN */
        #visor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
            cursor: pointer;
        }

        #visor img {
            max-width: 95%;
            max-height: 95%;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* ADMIN TOOLS */
        .admin-tools {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .admin-tools h4 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .admin-row {
            margin-bottom: 12px;
        }

        .admin-row label {
            font-size: 13px;
            font-weight: 600;
            color: var(--dark);
            display: block;
            margin-bottom: 5px;
        }

        .admin-row input {
            width: 100%;
            padding: 10px;
            font-size: 13px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
            grid-column: 1/-1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--primary);
            font-weight: 600;
            grid-column: 1/-1;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div id="visor" onclick="cerrarVisor()">
    <img id="imgFull" src="" alt="Imagen ampliada">
</div>

<div class="container">
    <!-- LOGIN -->
    <div class="card login-wrapper" id="loginBox">
        <div class="login-header">
            <h1>üéØ TuControlRamos</h1>
            <p>Sistema de Gesti√≥n Premium</p>
        </div>
        <div class="login-body">
            <div class="form-group">
                <label>Tipo de Acceso</label>
                <select id="rolAcceso">
                    <option value="empresa">üëî Empresa</option>
                    <option value="admin">‚öôÔ∏è Administrador</option>
                </select>
            </div>
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="u" placeholder="Ingresa tu usuario">
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="p" placeholder="Ingresa tu contrase√±a">
            </div>
            <button class="btn btn-primary" id="btnLogin">Iniciar Sesi√≥n</button>
            <p class="error-msg" id="err"></p>
        </div>
    </div>

    <!-- PANEL EMPRESA -->
    <div class="card hidden" id="pEmpresa">
        <div class="panel-header">
            <div class="panel-header-left">
                <div class="badge badge-empresa">Sesi√≥n Empresa</div>
                <h2 id="nomEmp"></h2>
            </div>
            <button class="btn btn-danger" onclick="salir()">Cerrar Sesi√≥n</button>
        </div>
        <div class="panel-body">
            <div class="upload-section">
                <h3>üì§ Subir Nueva Imagen</h3>
                <div class="form-group">
                    <input type="file" id="file" accept="image/*">
                </div>
                <button class="btn btn-success" id="btnSubir">
                    Subir a la Nube
                </button>
                <div class="status-msg" id="statusMsg"></div>
            </div>

            <h3 class="section-title">üñºÔ∏è Mis Archivos Cargados</h3>
            <div class="grid" id="gridEmp">
                <div class="loading"><div class="spinner"></div><p style="margin-top:15px">Cargando im√°genes...</p></div>
            </div>
        </div>
    </div>

    <!-- PANEL ADMIN -->
    <div class="card hidden" id="pAdmin">
        <div class="panel-header">
            <div class="panel-header-left">
                <div class="badge badge-admin">Sesi√≥n Administrador</div>
                <h2>Panel de Control Maestro</h2>
            </div>
            <button class="btn btn-danger" onclick="salir()">Cerrar Sesi√≥n</button>
        </div>
        <div class="panel-body">
            <div class="admin-tools">
                <h4>‚öôÔ∏è Crear Nueva Empresa</h4>
                <div class="admin-row">
                    <label>Nombre de Empresa:</label>
                    <input type="text" id="nuevaEmpresa" placeholder="ejemplo: empresa35">
                </div>
                <div class="admin-row">
                    <label>Contrase√±a:</label>
                    <input type="text" id="nuevaPass" placeholder="Contrase√±a de la empresa">
                </div>
                <button class="btn btn-success" onclick="crearEmpresa()">
                    ‚ûï Crear Empresa
                </button>
            </div>

            <h3 class="section-title">üåê Vista Global de Archivos</h3>
            <div class="grid" id="gridAdm">
                <div class="loading"><div class="spinner"></div><p style="margin-top:15px">Cargando im√°genes...</p></div>
            </div>
        </div>
    </div>
</div>

<script>
// ============================================
// CONFIGURACI√ìN DE FIREBASE
// ============================================
const firebaseConfig = {
    apiKey: "AIzaSyClaqvS1LUSZtaeIgvNtKdBGVDi3fEii60",
    authDomain: "tucontrolramos-8ec4a.firebaseapp.com",
    projectId: "tucontrolramos-8ec4a",
    storageBucket: "tucontrolramos-8ec4a.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

let usuarioActual = "";

// ============================================
// LOGIN
// ============================================
document.getElementById('btnLogin').addEventListener('click', function() {
    const tipo = document.getElementById('rolAcceso').value;
    const usuario = document.getElementById('u').value.toLowerCase().trim();
    const password = document.getElementById('p').value.trim();
    const errElement = document.getElementById('err');

    errElement.textContent = "";

    if (!usuario || !password) {
        errElement.textContent = "Por favor, completa todos los campos";
        return;
    }

    if (tipo === "admin") {
        if (usuario === "admin" && password === "colgate") {
            document.getElementById('loginBox').classList.add('hidden');
            document.getElementById('pAdmin').classList.remove('hidden');
            cargarFotosAdmin();
        } else {
            errElement.textContent = "‚ùå Usuario o contrase√±a de administrador incorrectos";
        }
    } else {
        // Login empresa
        db.collection("empresas").doc(usuario).get()
            .then(doc => {
                if (doc.exists && doc.data().pass === password) {
                    usuarioActual = usuario;
                    document.getElementById('nomEmp').textContent = "üëã " + usuario;
                    document.getElementById('loginBox').classList.add('hidden');
                    document.getElementById('pEmpresa').classList.remove('hidden');
                    cargarFotosEmpresa();
                } else {
                    errElement.textContent = "‚ùå Usuario o contrase√±a de empresa incorrectos";
                }
            })
            .catch(error => {
                console.error("Error:", error);
                errElement.textContent = "‚ùå Error al verificar credenciales";
            });
    }
});

// Enter para login
document.getElementById('u').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('btnLogin').click();
});
document.getElementById('p').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('btnLogin').click();
});

// ============================================
// CREAR EMPRESA (ADMIN)
// ============================================
function crearEmpresa() {
    const nombre = document.getElementById('nuevaEmpresa').value.toLowerCase().trim();
    const pass = document.getElementById('nuevaPass').value.trim();

    if (!nombre || !pass) {
        alert("‚ö†Ô∏è Completa todos los campos");
        return;
    }

    db.collection("empresas").doc(nombre).set({ pass: pass })
        .then(() => {
            alert("‚úÖ Empresa '" + nombre + "' creada exitosamente");
            document.getElementById('nuevaEmpresa').value = "";
            document.getElementById('nuevaPass').value = "";
        })
        .catch(error => {
            console.error("Error:", error);
            alert("‚ùå Error al crear empresa");
        });
}

// ============================================
// CARGAR FOTOS EMPRESA
// ============================================
function cargarFotosEmpresa() {
    db.collection("imagenes").where("empresa", "==", usuarioActual)
        .onSnapshot(snapshot => {
            const grid = document.getElementById('gridEmp');
            grid.innerHTML = '';

            if (snapshot.empty) {
                grid.innerHTML = '<div class="empty-state"><p>No hay im√°genes cargadas</p></div>';
                return;
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `
                    <div class="image-wrapper">
                        <img src="${data.url}" alt="Imagen" onclick="verFull('${data.url}')">
                    </div>
                    <div class="image-info">
                        <div class="image-name">${data.empresa || 'Sin nombre'}</div>
                        <div class="image-meta">Subida el ${new Date(data.timestamp || 0).toLocaleDateString()}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }, error => {
            console.error("Error:", error);
            document.getElementById('gridEmp').innerHTML = '<div class="empty-state"><p style="color: var(--danger);">Error al cargar im√°genes</p></div>';
        });
}

// ============================================
// CARGAR FOTOS ADMIN
// ============================================
function cargarFotosAdmin() {
    db.collection("imagenes").onSnapshot(snapshot => {
        const grid = document.getElementById('gridAdm');
        grid.innerHTML = '';

        if (snapshot.empty) {
            grid.innerHTML = '<div class="empty-state"><p>No hay im√°genes en el sistema</p></div>';
            return;
        }

        snapshot.forEach(doc => {
            const data = doc.data();
            const card = document.createElement('div');
            card.className = 'image-card';
            card.innerHTML = `
                <div class="image-wrapper">
                    <img src="${data.url}" alt="Imagen" onclick="verFull('${data.url}')">
                </div>
                <div class="image-info">
                    <div class="image-name">Empresa: ${data.empresa || 'N/A'}</div>
                    <div class="image-meta">${new Date(data.timestamp || 0).toLocaleDateString()}</div>
                    <button class="btn-delete" onclick="eliminarImagen('${doc.id}')">üóëÔ∏è Eliminar</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }, error => {
        console.error("Error:", error);
        document.getElementById('gridAdm').innerHTML = '<div class="empty-state"><p style="color: var(--danger);">Error al cargar im√°genes</p></div>';
    });
}

// ============================================
// SUBIR IMAGEN
// ============================================
document.getElementById('btnSubir').addEventListener('click', async function() {
    const fileInput = document.getElementById('file');
    const statusElement = document.getElementById('statusMsg');
    const btnSubir = document.getElementById('btnSubir');

    if (!fileInput.files[0]) {
        statusElement.textContent = "‚ö†Ô∏è Por favor selecciona una imagen";
        statusElement.className = "status-msg status-error";
        return;
    }

    btnSubir.disabled = true;
    btnSubir.textContent = "Subiendo...";
    statusElement.textContent = "‚è≥ Subiendo imagen...";
    statusElement.className = "status-msg status-info";

    try {
        const file = fileInput.files[0];
        const path = "fotos/" + Date.now() + "_" + file.name;
        const ref = storage.ref(path);
        
        await ref.put(file);
        const url = await ref.getDownloadURL();
        
        await db.collection("imagenes").add({
            empresa: usuarioActual,
            url: url,
            timestamp: Date.now()
        });

        statusElement.textContent = "‚úÖ ¬°Imagen subida exitosamente!";
        statusElement.className = "status-msg status-success";
        fileInput.value = "";
        
        setTimeout(() => {
            statusElement.textContent = "";
        }, 3000);
    } catch (error) {
        console.error("Error:", error);
        statusElement.textContent = "‚ùå Error: Verifica las reglas de Firebase";
        statusElement.className = "status-msg status-error";
    }

    btnSubir.disabled = false;
    btnSubir.textContent = "Subir a la Nube";
});

// ============================================
// ELIMINAR IMAGEN (ADMIN)
// ============================================
function eliminarImagen(id) {
    if (confirm('¬øEst√°s seguro de eliminar esta imagen?')) {
        db.collection("imagenes").doc(id).delete()
            .then(() => {
                console.log("‚úÖ Imagen eliminada");
            })
            .catch(error => {
                console.error("Error:", error);
                alert("Error al eliminar la imagen");
            });
    }
}

// ============================================
// VER IMAGEN COMPLETA
// ============================================
function verFull(src) {
    document.getElementById('imgFull').src = src;
    document.getElementById('visor').style.display = 'flex';
}

function cerrarVisor() {
    document.getElementById('visor').style.display = 'none';
}

// ============================================
// SALIR
// ============================================
function salir() {
    location.reload();
}

console.log("üöÄ Sistema TuControlRamos Premium iniciado");
</script>
</body>
</html>
