<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuControlRamos - Controles Remotos y Reparaciones</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --rojo-principal: #D32F2F; --rojo-oscuro: #B71C1C; --rojo-claro: #EF5350; --negro: #1A1A1A; --gris-oscuro: #2C2C2C; --gris-medio: #757575; --gris-claro: #E0E0E0; --blanco: #FFFFFF; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--blanco); color: var(--negro); overflow-x: hidden; }
        .header { background: linear-gradient(135deg, var(--rojo-oscuro) 0%, var(--rojo-principal) 100%); padding: 1rem 0; box-shadow: 0 4px 20px rgba(211, 47, 47, 0.3); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--blanco); letter-spacing: 3px; }
        .nav-menu { display: flex; gap: 2rem; list-style: none; }
        .nav-menu a { color: var(--blanco); text-decoration: none; font-weight: 600; font-size: 0.95rem; text-transform: uppercase; }
        .cart-icon { position: relative; cursor: pointer; color: var(--blanco); font-size: 1.5rem; }
        .cart-count { position: absolute; top: -8px; right: -8px; background-color: var(--rojo-oscuro); color: var(--blanco); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; }
        .hero { background: linear-gradient(135deg, var(--negro) 0%, var(--gris-oscuro) 100%); padding: 6rem 2rem; text-align: center; }
        .hero h1 { font-family: 'Bebas Neue', sans-serif; font-size: 4.5rem; color: var(--blanco); margin-bottom: 1.5rem; }
        .hero-subtitle { font-size: 1.3rem; color: var(--gris-claro); }
        .hero-highlight { color: var(--rojo-claro); font-weight: 700; }
        .products-section { max-width: 1400px; margin: 4rem auto; padding: 0 2rem; }
        .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; color: var(--rojo-principal); text-align: center; margin-bottom: 3rem; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
        .product-card { background: var(--blanco); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); transition: 0.3s; }
        .product-card:hover { transform: translateY(-8px); }
        .product-info { padding: 1.5rem; }
        .product-price { font-size: 1.8rem; font-weight: 700; color: var(--rojo-principal); }
        .add-to-cart-btn { background: var(--rojo-principal); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px; }
        
        /* Modal Carrito */
        .cart-modal { position: fixed; top: 0; right: -100%; width: 450px; height: 100vh; background: white; z-index: 2000; transition: 0.4s; display: flex; flex-direction: column; box-shadow: -5px 0 15px rgba(0,0,0,0.2); }
        .cart-modal.active { right: 0; }
        .cart-header { background: var(--rojo-principal); color: white; padding: 2rem; display: flex; justify-content: space-between; }
        .cart-items { flex: 1; overflow-y: auto; padding: 2rem; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gris-claro); }
        .cart-footer { padding: 2rem; background: #f9f9f9; }
        .checkout-btn { width: 100%; background: #009EE3; color: white; border: none; padding: 1.2rem; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .whatsapp-btn { width: 100%; background: #25D366; color: white; border: none; padding: 1.2rem; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1999; display: none; }
        .overlay.active { display: block; }
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 15px; height: 15px; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header class="header">
        <div class="nav-container">
            <div class="logo">TUCONTROLRAMOS</div>
            <div class="cart-icon" onclick="toggleCart()">ðŸ›’ <span class="cart-count" id="cartCount">0</span></div>
        </div>
    </header>

    <section class="hero">
        <h1>Reparaciones Profesionales</h1>
        <p class="hero-subtitle">Especialistas en <span class="hero-highlight">Controles</span> y <span class="hero-highlight">Smart TV</span></p>
    </section>

    <section id="controles" class="products-section">
        <h2 class="section-title">Nuestros Servicios y Productos</h2>
        <div class="products-grid" id="productGrid"></div>
    </section>

    <div class="overlay" id="overlay" onclick="toggleCart()"></div>
    
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h2>Tu Carrito</h2>
            <button onclick="toggleCart()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">Ã—</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem; font-size:1.5rem; font-weight:bold;">
                <span>Total:</span> <span id="cartTotal">$0</span>
            </div>
            <button class="checkout-btn" onclick="checkoutMercadoPago()" id="checkoutBtn">
                <span id="btnText">ðŸ’³ Pagar con Mercado Pago</span>
            </button>
            <button class="whatsapp-btn" onclick="checkoutWhatsApp()">
                ðŸ“± Consultar por WhatsApp
            </button>
        </div>
    </div>

    <script>
        // CONFIGURACIÃ“N 
        const MP_PUBLIC_KEY = 'APP_USR-21e2b568-28e8-4378-b32f-3bd115b09f07'; // <--- PEGA TU CLAVE ACA
        const BACKEND_URL = 'http://localhost:3000'; 

        const mp = new MercadoPago(MP_PUBLIC_KEY, { locale: 'es-AR' });

        const products = [
            { id: 1, name: "Control Universal Smart TV", price: 8500 },
            { id: 2, name: "Control Original Samsung", price: 12000 },
            { id: 7, name: "ReparaciÃ³n Pantalla LED", price: 35000 },
            { id: 13, name: "Cambio Pantalla iPhone", price: 45000 }
        ];

        let cart = [];

        function renderProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <div class="product-info">
                        <h3>${p.name}</h3>
                        <p class="product-price">$${p.price.toLocaleString('es-AR')}</p>
                        <button class="add-to-cart-btn" onclick="addToCart(${p.id})">Agregar al Carrito</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const inCart = cart.find(item => item.id === id);
            if (inCart) inCart.quantity++;
            else cart.push({ ...product, quantity: 1 });
            updateCart();
        }

        function updateCart() {
            const itemsContainer = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            
            cartCount.innerText = cart.reduce((acc, item) => acc + item.quantity, 0);
            
            if (cart.length === 0) {
                itemsContainer.innerHTML = '<p style="text-align:center; color:gray;">El carrito estÃ¡ vacÃ­o</p>';
            } else {
                itemsContainer.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            ${item.quantity} x $${item.price}
                        </div>
                        <button onclick="removeFromCart(${item.id})" style="color:red; cursor:pointer; background:none; border:none;">Eliminar</button>
                    </div>
                `).join('');
            }

            const total = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            cartTotal.innerText = `$${total.toLocaleString('es-AR')}`;
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCart();
        }

        function toggleCart() {
            document.getElementById('cartModal').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        async function checkoutMercadoPago() {
            if (cart.length === 0) return alert("Carrito vacÃ­o");
            
            const btn = document.getElementById('checkoutBtn');
            const btnText = document.getElementById('btnText');
            
            try {
                btn.disabled = true;
                btnText.innerHTML = '<span class="spinner"></span> Procesando...';

                const response = await fetch(`${BACKEND_URL}/create-preference`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ items: cart })
                });

                const data = await response.json();
                
                if (data.id) {
                    mp.checkout({ preference: { id: data.id }, autoOpen: true });
                } else {
                    alert("Error al crear el pago");
                }
            } catch (e) {
                alert("No se pudo conectar con el servidor de pagos.");
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'ðŸ’³ Pagar con Mercado Pago';
            }
        }

        function checkoutWhatsApp() {
            const text = cart.map(i => `${i.quantity}x ${i.name}`).join('%0A');
            window.open(`https://wa.me/5491137651905?text=Hola! Quiero comprar:%0A${text}`, '_blank');
        }

        renderProducts();
    </script>
</body>
</html>
