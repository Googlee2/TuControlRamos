<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>TuControlRamos â€“ Cargador de Datos Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#dff3ff;
  margin:0;
}
.container{
  max-width:1200px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
}
h2{text-align:center}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
}
button{
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.green{background:#2ecc71;color:#fff}
.red{background:#e74c3c;color:#fff}
.hidden{display:none}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center
}

.progress{
  width:100%;
  height:22px;
  background:#ddd;
  border-radius:12px;
  overflow:hidden;
  margin:10px 0;
}
.progress div{
  height:100%;
  width:0%;
  transition:.3s;
}

img.preview{
  max-width:120px;
  max-height:90px;
  border-radius:6px;
  border:1px solid #ccc;
  object-fit:contain;
}
.small-btn{
  padding:6px 10px;
  width:auto;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="container" id="loginBox">
  <h2>Ingreso</h2>
  <select id="tipo">
    <option value="admin">Administrador</option>
    <option value="empresa">Empresa</option>
  </select>
  <input id="user" placeholder="Usuario">
  <input id="pass" type="password" placeholder="ContraseÃ±a">
  <button class="green" onclick="login()">Ingresar</button>
</div>

<!-- ADMIN -->
<div class="container hidden" id="adminBox">
  <h2>Panel Administrador</h2>

  <h3>Crear empresa</h3>
  <input id="newEmpresa" placeholder="Usuario empresa">
  <input id="newPass" placeholder="ContraseÃ±a empresa">
  <button class="green" onclick="crearEmpresa()">Crear empresa</button>

  <h3>Archivos cargados</h3>
  <table>
    <thead>
      <tr>
        <th>Empresa</th>
        <th>Archivo</th>
        <th>Tipo</th>
        <th>TamaÃ±o (MB)</th>
        <th>Vista</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaAdmin"></tbody>
  </table>

  <button class="red" onclick="resetTodo()">RESET TOTAL</button>
  <button onclick="logout()">Salir</button>
</div>

<!-- EMPRESA -->
<div class="container hidden" id="empresaBox">
  <h2 id="empresaTitulo"></h2>

  <input type="file" id="file" accept="image/*">
  <button class="green" onclick="subir()">Subir imagen</button>

  <p><b>Uso de espacio</b></p>
  <div class="progress"><div id="barra"></div></div>
  <p id="usoTexto"></p>

  <h3>Mis archivos</h3>
  <table>
    <thead>
      <tr>
        <th>Archivo</th>
        <th>Tipo</th>
        <th>TamaÃ±o (MB)</th>
        <th>Vista</th>
      </tr>
    </thead>
    <tbody id="tablaEmpresa"></tbody>
  </table>

  <button onclick="logout()">Salir</button>
</div>

<!-- VISOR -->
<div id="visor"
style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9999;justify-content:center;align-items:center;"
onclick="cerrarVisor()">
  <img id="visorImg" style="max-width:90%;max-height:90%;border-radius:10px;">
</div>

<script>
/* ================= UTIL ================= */
const esCelular = () => /Android|iPhone|iPad/i.test(navigator.userAgent);

const getEmpresas = () => JSON.parse(localStorage.getItem("empresas") || "{}");
const saveEmpresas = d => localStorage.setItem("empresas", JSON.stringify(d));
const getArchivos = () => JSON.parse(localStorage.getItem("archivos") || "{}");
const saveArchivos = d => localStorage.setItem("archivos", JSON.stringify(d));

let usuarioActual = null;

/* ============ INIT ============ */
if(!localStorage.getItem("empresas")){
  saveEmpresas({ empresa35:{pass:"1234"} });
}
if(!localStorage.getItem("archivos")){
  saveArchivos({});
}

/* ============ LOGIN ============ */
function login(){
  const t = tipo.value;
  const u = user.value.trim();
  const p = pass.value.trim();

  if(!u||!p) return alert("Datos incompletos");

  if(t==="admin"){
    if(u==="admin" && p==="colgate"){
      loginBox.classList.add("hidden");
      adminBox.classList.remove("hidden");
      renderAdmin();
    } else alert("Admin incorrecto");
  }else{
    const e = getEmpresas();
    if(!e[u]) return alert("Empresa no existe");
    if(e[u].pass!==p) return alert("Clave incorrecta");

    usuarioActual=u;
    loginBox.classList.add("hidden");
    empresaBox.classList.remove("hidden");
    empresaTitulo.innerText="Empresa: "+u;
    renderEmpresa();
  }
}

function logout(){ location.reload(); }

/* ============ IMAGEN CELULAR ============ */
function comprimirImagen(file){
  return new Promise(res=>{
    const fr=new FileReader();
    fr.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        const c=document.createElement("canvas");
        const max=1024;
        let w=img.width,h=img.height;
        if(w>h && w>max){ h*=max/w; w=max }
        else if(h>max){ w*=max/h; h=max }
        c.width=w;c.height=h;
        c.getContext("2d").drawImage(img,0,0,w,h);
        res(c.toDataURL("image/jpeg",0.7));
      };
      img.src=e.target.result;
    };
    fr.readAsDataURL(file);
  });
}

/* ============ SUBIR ============ */
async function subir(){
  const f=file.files[0];
  if(!f) return alert("SeleccionÃ¡ una imagen");

  const a=getArchivos();
  if(!a[usuarioActual]) a[usuarioActual]=[];

  let data;
  if(esCelular()){
    data=await comprimirImagen(f);
  }else{
    data=await new Promise(r=>{
      const fr=new FileReader();
      fr.onload=()=>r(fr.result);
      fr.readAsDataURL(f);
    });
  }

  a[usuarioActual].push({
    name:f.name,
    type:f.type,
    size:data.length,
    preview:data
  });

  saveArchivos(a);
  alert("Imagen cargada correctamente");
  renderEmpresa();
}

/* ============ RENDER ============ */
function renderEmpresa(){
  const a=getArchivos()[usuarioActual]||[];
  tablaEmpresa.innerHTML="";
  a.forEach(f=>{
    tablaEmpresa.innerHTML+=`
    <tr>
      <td>${f.name}</td>
      <td>${f.type}</td>
      <td>${(f.size/1024/1024).toFixed(2)}</td>
      <td><img src="${f.preview}" class="preview" onclick="verImagen('${f.preview}')"></td>
    </tr>`;
  });
}

function renderAdmin(){
  const a=getArchivos();
  tablaAdmin.innerHTML="";
  for(let e in a){
    a[e].forEach((f,i)=>{
      tablaAdmin.innerHTML+=`
      <tr>
        <td>${e}</td>
        <td>${f.name}</td>
        <td>${f.type}</td>
        <td>${(f.size/1024/1024).toFixed(2)}</td>
        <td><img src="${f.preview}" class="preview" onclick="verImagen('${f.preview}')"></td>
        <td><button class="red small-btn" onclick="borrarArchivo('${e}',${i})">ðŸ—‘</button></td>
      </tr>`;
    });
  }
}

function borrarArchivo(e,i){
  const a=getArchivos();
  a[e].splice(i,1);
  saveArchivos(a);
  renderAdmin();
}

function verImagen(src){
  visorImg.src=src;
  visor.style.display="flex";
}
function cerrarVisor(){
  visor.style.display="none";
  visorImg.src="";
}

function resetTodo(){
  if(confirm("Â¿Borrar todo?")){
    localStorage.clear();
    location.reload();
  }
}
</script>

</body>
</html>


