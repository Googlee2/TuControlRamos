<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuControlRamos - Control Total</title>
    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #e2e8f0;
            margin: 0;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
        }

        .card {
            background: white; padding: 25px; border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 95%; max-width: 900px;
        }

        .hidden { display: none !important; }

        /* Login */
        .login-box { max-width: 400px; text-align: center; margin: auto; }
        input, select, button {
            width: 100%; padding: 12px; margin: 8px 0;
            border-radius: 8px; border: 1px solid #cbd5e1; box-sizing: border-box;
        }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }

        /* Estilos de Paneles */
        .header-panel { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 20px; }
        
        .grid-archivos {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px; margin-top: 15px;
        }

        .file-card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 10px; text-align: center; }
        .preview-img { width: 100%; height: 90px; object-fit: cover; border-radius: 8px; cursor: pointer; }

        /* Gestión de Usuarios Table */
        .user-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .user-table th, .user-table td { border: 1px solid #e2e8f0; padding: 10px; text-align: left; }
        .user-table th { background: #f8fafc; }

        .btn-small { padding: 5px 10px; font-size: 0.75rem; width: auto; margin: 2px; }

        /* Modal Viewer */
        #modalViewer {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); display: none;
            justify-content: center; align-items: center; z-index: 1000;
        }
        #modalViewer img { max-width: 90%; max-height: 85%; border-radius: 5px; }
    </style>
</head>
<body>

<div id="modalViewer" onclick="this.style.display='none'">
    <img id="imgFull" src="">
</div>

<div class="card login-box" id="loginSection">
    <h2 style="color: var(--primary);">TuControlRamos</h2>
    <input type="text" id="userInput" placeholder="Usuario">
    <input type="password" id="passInput" placeholder="Contraseña">
    <button onclick="login()">INGRESAR AL PANEL</button>
    <p id="errorMsg" style="color:red; font-size:0.8rem;"></p>
</div>

<div class="card hidden" id="panelEmpresa">
    <div class="header-panel">
        <h2 id="welcomeEmpresa">Panel Empresa</h2>
        <button onclick="logout()" style="width:auto; background:var(--danger)">Cerrar Sesión</button>
    </div>
    <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
        <strong>Cargar en TuControlRamos/</strong>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <select id="folderSelect" style="flex:1">
                <option value="imag">imag/</option>
                <option value="read">read/</option>
            </select>
            <input type="file" id="fileInput" style="flex:2">
            <button onclick="upload()" style="flex:1; background:var(--success)">SUBIR</button>
        </div>
    </div>
    <h3>Mis Archivos</h3>
    <div class="grid-archivos" id="empresaGrid"></div>
</div>

<div class="card hidden" id="panelAdmin">
    <div class="header-panel">
        <h2 style="color:var(--primary)">Control Maestro - Admin</h2>
        <button onclick="logout()" style="width:auto; background:var(--danger)">Salir</button>
    </div>

    <div style="background:#fff7ed; padding:15px; border-radius:10px; border:1px solid #ffedd5; margin-bottom:20px;">
        <h3 style="margin-top:0; color:#9a3412">Gestión de Usuarios y Accesos</h3>
        <table class="user-table">
            <thead>
                <tr>
                    <th>Rol</th>
                    <th>Nombre de Usuario</th>
                    <th>Contraseña</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
        </table>
    </div>

    <h3>Gestión de Archivos (Empresa)</h3>
    <div style="margin-bottom:10px;">
        <button onclick="renderFiles('admin','all')" class="btn-small">Todos</button>
        <button onclick="renderFiles('admin','imag')" class="btn-small" style="background:var(--secondary)">imag/</button>
        <button onclick="renderFiles('admin','read')" class="btn-small" style="background:var(--secondary)">read/</button>
    </div>
    <div class="grid-archivos" id="adminGrid"></div>
</div>

<script>
    // Inicializar credenciales en LocalStorage si no existen
    if (!localStorage.getItem('TCR_CRED')) {
        const creds = {
            admin: { u: "admin", p: "colgate" },
            empresa: { u: "empresa35", p: "flac" }
        };
        localStorage.setItem('TCR_CRED', JSON.stringify(creds));
    }

    function login() {
        const u = document.getElementById('userInput').value;
        const p = document.getElementById('passInput').value;
        const creds = JSON.parse(localStorage.getItem('TCR_CRED'));

        if (u === creds.admin.u && p === creds.admin.p) {
            showPanel('panelAdmin');
            renderAdminUsers();
            renderFiles('admin');
        } else if (u === creds.empresa.u && p === creds.empresa.p) {
            document.getElementById('welcomeEmpresa').textContent = "Panel: " + u;
            showPanel('panelEmpresa');
            renderFiles('empresa');
        } else {
            document.getElementById('errorMsg').textContent = "Usuario o clave incorrectos.";
        }
    }

    function showPanel(id) {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    // GESTIÓN DE USUARIOS (Solo Admin)
    function renderAdminUsers() {
        const creds = JSON.parse(localStorage.getItem('TCR_CRED'));
        const container = document.getElementById('userTableBody');
        container.innerHTML = `
            <tr>
                <td><strong>Administrador</strong></td>
                <td><input type="text" id="editUAdmin" value="${creds.admin.u}"></td>
                <td><input type="text" id="editPAdmin" value="${creds.admin.p}"></td>
                <td><button onclick="saveCreds('admin')" class="btn-small" style="background:var(--success)">Guardar</button></td>
            </tr>
            <tr>
                <td><strong>Empresa</strong></td>
                <td><input type="text" id="editUEmpresa" value="${creds.empresa.u}"></td>
                <td><input type="text" id="editPEmpresa" value="${creds.empresa.p}"></td>
                <td><button onclick="saveCreds('empresa')" class="btn-small" style="background:var(--success)">Guardar</button></td>
            </tr>
        `;
    }

    function saveCreds(type) {
        const creds = JSON.parse(localStorage.getItem('TCR_CRED'));
        if(type === 'admin') {
            creds.admin.u = document.getElementById('editUAdmin').value;
            creds.admin.p = document.getElementById('editPAdmin').value;
        } else {
            creds.empresa.u = document.getElementById('editUEmpresa').value;
            creds.empresa.p = document.getElementById('editPEmpresa').value;
        }
        localStorage.setItem('TCR_CRED', JSON.stringify(creds));
        alert("Credenciales de " + type + " actualizadas con éxito.");
    }

    // GESTIÓN DE ARCHIVOS
    function upload() {
        const input = document.getElementById('fileInput');
        const folder = document.getElementById('folderSelect').value;
        if(!input.files[0]) return alert("Selecciona archivo");

        const reader = new FileReader();
        reader.onload = function(e) {
            const db = JSON.parse(localStorage.getItem('TCR_FILES') || '[]');
            db.push({ id: Date.now(), name: input.files[0].name, folder: folder, data: e.target.result, isImg: input.files[0].type.startsWith('image') });
            localStorage.setItem('TCR_FILES', JSON.stringify(db));
            renderFiles('empresa');
            input.value = '';
        };
        reader.readAsDataURL(input.files[0]);
    }

    function renderFiles(role, filter = 'all') {
        const grid = document.getElementById(role === 'empresa' ? 'empresaGrid' : 'adminGrid');
        let db = JSON.parse(localStorage.getItem('TCR_FILES') || '[]');
        if(filter !== 'all') db = db.filter(f => f.folder === filter);
        grid.innerHTML = db.length === 0 ? '<p>Vacío</p>' : '';

        db.forEach(file => {
            const thumb = file.isImg ? file.data : 'https://cdn-icons-png.flaticon.com/512/124/124837.png';
            let html = `<div class="file-card">
                <img src="${thumb}" class="preview-img" onclick="openFull('${file.data}')">
                <div style="font-size:0.7rem; font-weight:bold; margin-top:5px;">${file.name}</div>
                <span style="font-size:0.6rem; background:#eee; padding:2px 5px;">/${file.folder}</span>`;
            if(role === 'admin') {
                html += `<div style="margin-top:5px;">
                    <button onclick="moveF(${file.id})" class="btn-small" style="background:var(--secondary)">Mover</button>
                    <button onclick="delF(${file.id})" class="btn-small" style="background:var(--danger)">X</button>
                </div>`;
            }
            html += `</div>`;
            grid.innerHTML += html;
        });
    }

    function delF(id) {
        let db = JSON.parse(localStorage.getItem('TCR_FILES')).filter(f => f.id !== id);
        localStorage.setItem('TCR_FILES', JSON.stringify(db));
        renderFiles('admin');
    }

    function moveF(id) {
        let db = JSON.parse(localStorage.getItem('TCR_FILES'));
        let f = db.find(x => x.id === id);
        f.folder = f.folder === 'imag' ? 'read' : 'imag';
        localStorage.setItem('TCR_FILES', JSON.stringify(db));
        renderFiles('admin');
    }

    function openFull(src) {
        document.getElementById('imgFull').src = src;
        document.getElementById('modalViewer').style.display = 'flex';
    }

    function logout() { location.reload(); }
</script>
</body>
</html>
